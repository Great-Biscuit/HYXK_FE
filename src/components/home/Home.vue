<template>
  <el-container>
    <el-header>
      <Header @openMenu="openMenu"/>
    </el-header>
    <el-main>
      <el-menu
        :default-active="activeIndex"
        class="el-menu-demo"
        mode="horizontal"
        @select="handleSelect"
      >
        <el-menu-item index="1">最新</el-menu-item>
        <el-menu-item index="0">热门</el-menu-item>
      </el-menu>
      <ul v-infinite-scroll="load" class="infinite-list" style="overflow: auto">
        <li v-for="postVo in postList" :key="postVo" class="infinite-list-item">
          <PostIntro :postVo="postVo" />
        </li>
      </ul>
    </el-main>
    <el-footer>
      <Footer/>
    </el-footer>
  </el-container>
  <el-drawer
    v-model="drawer"
    title="✨皓月星空站"
    :direction="direction" 
    size="75%" 
  >
    <div class="menu-item">
      <span class="menu-item-content" v-on:click="toHome">🔭首页</span>
    </div>
    <div class="menu-item">
      <span class="menu-item-content">📫公告</span>
    </div>
    <div class="menu-item">
      <span class="menu-item-content">💬问答</span>
    </div>
    <div class="menu-item">
      <span class="menu-item-content">🌱表白墙</span>
    </div>
    <div class="developer-info">
      Developed By <span onclick="javascript:window.open('https://www.greatbiscuit.top/')" class="developer-name">GreatBiscuit</span>
    </div>
  </el-drawer>
</template>

<script>

import Footer from './Footer.vue'
import Header from './Header.vue'
import PostIntro from './PostIntro.vue'
import { post } from '../../utils/axios'
import { ElNotification } from 'element-plus'

export default {
  name: 'Home',
  components: {
    Header,
    Footer,
    PostIntro
  },
  data () {
    return {
      activeIndex : "1",
      count : 0,
      postList : [],
      drawer: false,
      direction: "ltr"
    }
  },
  methods: {
    load () {
      let formData = new FormData()
      formData.append('userId', 0)
      formData.append('type', this.activeIndex)
      formData.append('offset', this.count)
      formData.append('limit', 8)
      formData.append('orderMode', 0)
      post('/post-public/queryAll', formData)
        .then(response => {
          if (response.code === 200) {
            // 每次取8条
            this.postList.push(...response.data);
            this.count += response.data.length;
          } else {
            ElNotification({
              title: "错误: " + response.code,
              message: response.msg,
              type: 'error',
              duration: 2000,
            })
          }
        })
        .catch(() => {
            ElNotification({
              title: "错误",
              message: "发生错误!",
              type: 'error',
              duration: 2000,
            })
        })
    },
    handleSelect (index) {
      // 重置数据
      this.activeIndex = index;
      this.count = 0;
      this.postList = [];
      this.load();
    },
    openMenu () {
      this.drawer = true
    },
    // 跳到首页
    toHome () {
      this.$router.replace({path: '/Home'})
    },
  }
}
</script>

<style scoped>
.el-container {
  background-size: 100% 100%;
	width:100vw;
	height:100vh;
  margin: -8px;
}
.el-header {
  height: 50px;
  padding: 10px 20px;
}
.el-main {
  height: auto;
  padding: 0;
  overflow: hidden;
}
.el-menu-demo {
  height: 5%;
}
.el-footer {
  height: 49px;
  padding: 10px 15px;
}
.infinite-list {
  height: 94%;
  padding: 0;
  list-style: none;
  margin: 1%;
}
.infinite-list .infinite-list-item {
  display: flex;
  height: 120px;
  margin: 10px;
  color: var(--el-color-primary);
}
.infinite-list .infinite-list-item + .list-item {
  margin-top: 10px;
}
.menu-item {
  margin-bottom: 50px;
}
.menu-item-content {
  font-family:黑体;
  font-size: 18px !important;
  font-weight:bolder;
  letter-spacing: 3px;
}
.developer-info {
  text-align: center;
  font-family:"Times New Roman";
  position: relative;
  bottom: -45%;
}
.developer-name {
  font-size: 18px !important;
  font-weight:bolder;
  color: #0095ffc7;
}
</style>